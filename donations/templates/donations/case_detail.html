{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block content %}
<div class="container" id="case_{{ case.id }}">
  <div class="text-center mb-5">
  </div>

  <div class="row justify-content-center">
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm product-item" 
           data-id="case-{{ case.id }}" 
           data-name="{{ case.title }}" 
           data-price="1" 
           data-img="{% if case.image %}{{ case.image.url }}{% endif %}" 
           data-type="cases">

        {% if case.image %}
        <img src="{{ case.image.url }}" class="card-img-top" alt="{{ case.title }}">
        {% endif %}

        <div class="card-body">
          <!-- عنوان الحالة -->
          <h5 class="case-title semi-bold fs-5">{{ case.title }}</h5>

          <!-- الوصف -->
          <p class="case-desc c-6 fs-6 mt-2 mb-2">{{ case.description }}</p>

          <!-- الهدف والمبالغ المحصّلة وشريط التقدم -->
          <div class="mb-3">
            <div class="d-flex justify-content-between small mb-1">
              <span>{% trans "Goal" %}: <strong>{{ case.goal }}</strong> EGP</span>
              <span>{% trans "Collected" %}: <strong>{{ case.total_donations }}</strong> EGP</span>
            </div>

            <div class="progress mb-1">
              <div class="progress-bar bg-success" role="progressbar"
                   style="width: {{ case.progress_percent|floatformat:0 }}%;"></div>
            </div>

            <small class="text-muted">{{ case.progress_percent|floatformat:0 }}% {% trans "Complete" %}</small>
          </div>

          <!-- أرقام جاهزة -->
          <div class="mb-2 text-center">
            <span class="btn btn-outline-secondary btn-sm preset-amount" data-value="100">100</span>
            <span class="btn btn-outline-secondary btn-sm preset-amount" data-value="150">150</span>
            <span class="btn btn-outline-secondary btn-sm preset-amount" data-value="200">200</span>
            <span class="btn btn-outline-secondary btn-sm preset-amount" data-value="250">250</span>
            <span class="btn btn-outline-secondary btn-sm preset-amount" data-value="300">300</span>



          </div>

          <!-- إدخال المبلغ وزر التبرع -->
          <div class="d-flex align-items-center gap-2">
            <input type="number"
                   name="amount"
                   min="1"
                   value="1"
                   class="form-control form-control-sm flex-grow-1 text-center"
                   placeholder="{% trans "0.0 EGP" %}">

            <button type="button"
                    class="btn btn-sm btn-btnnn add-to-cart"
                    data-id="case-{{ case.id }}"
                    data-name="{{ case.title }}"
                    data-price="1"
                    data-img="{% if case.image %}{{ case.image.url }}{% endif %}"
                    data-type="cases"
                    style="white-space: nowrap;">
              <i class="fa fa-xs fa-cart-shopping me-1"></i>
              {% trans "Donate Now" %}
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="mt-4 text-center">
    <a href="{% url 'donations' %}" class="btn btn-outline-secondary">
      &larr; {% trans "Back to all cases" %}
    </a>
  </div>
</div>

<!-- JS لإضافة الحالة للسلة واختيار الأرقام الجاهزة -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const addBtn = document.querySelector('.add-to-cart');
    const amountInput = addBtn.previousElementSibling;



    // أرقام جاهزة
    document.querySelectorAll('.preset-amount').forEach(btn => {
        btn.addEventListener('click', function() {
            const value = this.dataset.value;
            amountInput.value = value;
        });
    });
});
</script>
{% endblock %}
